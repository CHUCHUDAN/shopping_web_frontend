import{a as g,c as y,f as D,g as k,F as T,d as t,h as x,t as _,i as P,j as H,u as A,o as C,b as l}from"./index-ac8ec398.js";import{_ as $,u as b,t as h,a as v,H as F,A as B,B as S,F as M}from"./FooterComponent-ffcba0a4.js";import{p as w}from"./product-cc9feb73.js";const q={class:"data-wrapper"},j=["onClick"],N={class:"product-data"},O={class:"product-price"},V={class:"product-num"},G={class:"userData-wrapper"},L={class:"product-name"},Q={class:"shopcar-num"},z={class:"shopcar-price"},I={class:"use-wrapper"},R={class:"control-button"},J=["onClick"],K=["onClick"],U={class:"delete-button"},W=["onClick"],X={__name:"ShopcarProduct",setup(E){const i=w(),a=b(),r=async p=>{window.scrollTo({top:0,behavior:"smooth"});const c=h.putTokenToHeader(),s=await v.DELETE(`/api/v1/shopcars/${p}`,void 0,c),{success:e,message:o}=s.data;return e?(i.deleteProducts(p),i.totalAmountCount(),a.setSuccess(o)):a.setError(o)},m=p=>{H.push(`/product/${p}`)};return(p,c)=>(g(!0),y(T,null,D(k(i).products,s=>{var e,o,n,u,d;return g(),y("div",{class:"product-wrapper",key:s.id},[t("div",q,[t("div",{class:"product-pic",style:x(`background-image: url('${(e=s.Product)==null?void 0:e.avatar}')`),onClick:f=>m(s.product_id)},null,12,j),t("div",N,[t("div",O,"售價: $ "+_((o=s.Product)==null?void 0:o.price),1),t("div",V,"存貨量: "+_((n=s.Product)==null?void 0:n.inventory_quantity),1)])]),t("div",G,[t("div",L,"商品名稱: "+_((u=s.Product)==null?void 0:u.name),1),t("div",Q,[P("購買數量: "),t("span",null,_(s.quantity),1)]),t("div",z,[P("累加金額: "),t("span",null,"$ "+_(s.quantity*((d=s.Product)==null?void 0:d.price)),1)])]),t("div",I,[t("div",R,[t("i",{class:"fa-solid fa-circle-plus plus",onClick:f=>k(i).setProductQuantity("plus",s.id)},null,8,J),t("i",{class:"fa-solid fa-circle-minus minus",onClick:f=>k(i).setProductQuantity("minus",s.id)},null,8,K)]),t("div",U,[t("i",{class:"fa-solid fa-trash delete","product-id":"item.product_id",onClick:f=>r(s.product_id)},null,8,W)])])])}),128))}},Y=$(X,[["__scopeId","data-v-31185e5a"]]);const Z={class:"shopcar-wrapper"},ss={class:"checkout-wrapper"},ts={class:"total-amount"},os={class:"checkout-button"},es={class:"updated-button"},cs={class:"products-wrapper"},as={__name:"ShopcarPage",setup(E){const i=A(),a=b(),r=w();a.clearErrorMessages(),a.clearSuccessMessages(),C(async()=>{const c=h.putTokenToHeader(),s=await v.GET("/api/v1/users",void 0,c),{success:e,user:o}=s.data;if(!e||o.role!=="buyer")return i.push("/")}),C(async()=>{const c=h.putTokenToHeader(),s=await v.GET("/api/v1/shopcars",void 0,c),{success:e,message:o,data:n}=s.data;return e?(r.totalAmount=n.totalAmount,r.setProduct(n.shopcars)):a.setError(o)});const m=async()=>{const c=r.products,s=Object.fromEntries(c.map(d=>[d.product_id,d.quantity])),e=h.putTokenToHeader(),o=await v.PATCH("/api/v1/shopcars",s,e),{success:n,message:u}=o.data;return n?a.setSuccess(u):a.setError(u)},p=async()=>{const c=r.products,s=Object.fromEntries(c.map(d=>[d.product_id,d.quantity])),e=h.putTokenToHeader(),o=await v.POST("/api/v1/shopcars/checkout",s,e),{success:n,message:u}=o.data;return n?(r.productCheckout(),r.totalAmount=0,a.setSuccess(u)):a.setError(u)};return(c,s)=>(g(),y(T,null,[l(F),t("div",Z,[l(B),t("div",ss,[t("div",ts,"總金額: "+_(k(r).totalAmount),1),t("div",os,[l(S,{msg:"結帳",backgroundColor:"background-color:#FFBD9D",onClick:p})]),t("div",es,[l(S,{msg:"更新",backgroundColor:"background-color:#FFBD9D",onClick:m})])]),t("div",cs,[l(Y)])]),l(M)],64))}},ds=$(as,[["__scopeId","data-v-6ae17c82"]]);export{ds as default};
