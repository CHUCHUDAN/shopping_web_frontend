import{a as f,c as g,f as w,g as m,F as C,d as s,h as D,t as l,i as y,u as x,o as P,b as p}from"./index-55c79f46.js";import{_ as T,u as $,t as h,a as v,H,A,B as S,F}from"./FooterComponent-a990d818.js";import{p as b}from"./product-baf1e9ba.js";const B={class:"data-wrapper"},M={class:"product-data"},q={class:"product-price"},N={class:"product-num"},O={class:"userData-wrapper"},V={class:"product-name"},j={class:"shopcar-num"},G={class:"shopcar-price"},L={class:"use-wrapper"},Q={class:"control-button"},z=["onClick"],I=["onClick"],R={class:"delete-button"},J=["onClick"],K={__name:"ShopcarProduct",setup(E){const i=b(),c=$(),r=async _=>{const k=h.putTokenToHeader(),t=await v.DELETE(`/api/v1/shopcars/${_}`,void 0,k),{success:o,message:e}=t.data;return o?(i.deleteProducts(_),i.totalAmountCount(),c.setSuccess(e)):c.setError(e)};return(_,k)=>(f(!0),g(C,null,w(m(i).products,t=>{var o,e,a,n,u;return f(),g("div",{class:"product-wrapper",key:t.id},[s("div",B,[s("div",{class:"product-pic",style:D(`background-image: url('${(o=t.Product)==null?void 0:o.avatar}')`)},null,4),s("div",M,[s("div",q,"售價: $ "+l((e=t.Product)==null?void 0:e.price),1),s("div",N,"存貨量: "+l((a=t.Product)==null?void 0:a.inventory_quantity),1)])]),s("div",O,[s("div",V,"商品名稱: "+l((n=t.Product)==null?void 0:n.name),1),s("div",j,[y("購買數量: "),s("span",null,l(t.quantity),1)]),s("div",G,[y("累加金額: "),s("span",null,"$ "+l(t.quantity*((u=t.Product)==null?void 0:u.price)),1)])]),s("div",L,[s("div",Q,[s("i",{class:"fa-solid fa-circle-plus plus",onClick:d=>m(i).setProductQuantity("plus",t.id)},null,8,z),s("i",{class:"fa-solid fa-circle-minus minus",onClick:d=>m(i).setProductQuantity("minus",t.id)},null,8,I)]),s("div",R,[s("i",{class:"fa-solid fa-trash delete","product-id":"item.product_id",onClick:d=>r(t.product_id)},null,8,J)])])])}),128))}},U=T(K,[["__scopeId","data-v-056242d9"]]);const W={class:"shopcar-wrapper"},X={class:"checkout-wrapper"},Y={class:"total-amount"},Z={class:"checkout-button"},ss={class:"updated-button"},ts={class:"products-wrapper"},os={__name:"ShopcarPage",setup(E){const i=x(),c=$(),r=b();c.clearErrorMessages(),c.clearSuccessMessages(),P(async()=>{const t=h.putTokenToHeader(),o=await v.GET("/api/v1/users",void 0,t),{success:e,user:a}=o.data;if(!e||a.role!=="buyer")return i.push("/")}),P(async()=>{const t=h.putTokenToHeader(),o=await v.GET("/api/v1/shopcars",void 0,t),{success:e,message:a,data:n}=o.data;return e?(r.totalAmount=n.totalAmount,r.setProduct(n.shopcars)):c.setError(a)});const _=async()=>{const t=r.products,o=Object.fromEntries(t.map(d=>[d.product_id,d.quantity])),e=h.putTokenToHeader(),a=await v.PATCH("/api/v1/shopcars",o,e),{success:n,message:u}=a.data;return n?c.setSuccess(u):c.setError(u)},k=async()=>{const t=r.products,o=Object.fromEntries(t.map(d=>[d.product_id,d.quantity])),e=h.putTokenToHeader(),a=await v.POST("/api/v1/shopcars/checkout",o,e),{success:n,message:u}=a.data;return n?(r.productCheckout(),r.totalAmount=0,c.setSuccess(u)):c.setError(u)};return(t,o)=>(f(),g(C,null,[p(H),s("div",W,[p(A),s("div",X,[s("div",Y,"總金額: "+l(m(r).totalAmount),1),s("div",Z,[p(S,{msg:"結帳",backgroundColor:"background-color:#FFBD9D",onClick:k})]),s("div",ss,[p(S,{msg:"更新",backgroundColor:"background-color:#FFBD9D",onClick:_})])]),s("div",ts,[p(U)])]),p(F)],64))}},rs=T(os,[["__scopeId","data-v-6ae17c82"]]);export{rs as default};
